#!/usr/bin/env bash
set -ex

testing() {
    docker run -it --rm -v $PWD:/eg beeshive/elegant-git-ci:3 ./.wf/tests-execution.bash $@
}

repository() {
    docker run -idt --rm --name repository --workdir /tmp/elegant-git-repo -v $PWD:/eg beeshive/elegant-git-ci:3 bash
    docker exec -it repository bash -c "source /eg/tests/addons-git.bash;source /eg/tests/addons-common.bash; init-repo"
    docker attach repository
}

commands=(
    testing
    repository
)

main() {
    local command=${1}
    if [[ -z "${command}" ]]; then
        select any in ${commands[@]}; do
            command=${any}
            break
        done
    else
        shift
    fi
    ${command} ${@}
}

main ${@}
